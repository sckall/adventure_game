# AI BOSS系统 - 实现文档

## 概述

为游戏添加了智能Boss系统，Boss能够实时学习玩家行为并调整战斗策略。

## 新增文件

### 1. scripts/ai_boss.gd
完整的AI Boss类，包含：
- 状态机系统 (6种状态)
- AI学习系统
- 预测系统
- 7种攻击模式
- 3个战斗阶段

### 2. scenes/ai_boss.tscn
Boss场景文件，包含：
- 身体、眼睛、瞳孔视觉效果
- 伤害区域和攻击区域
- 警告指示器

## 核心功能

### AI学习系统
Boss会实时分析玩家：
- 移动方向偏好（左/右）
- 跳跃频率统计
- 攻击距离偏好
- 位置区域停留频率
- 特殊时机行为（受伤后跳跃、边缘跳跃）

### 预测系统
- 基础预测：根据当前速度预测0.5秒后位置
- 高级预测：根据玩家习惯偏向调整预测
- 边缘预测：检测玩家靠近边缘时预测跳跃
- 预测置信度：0-1范围，影响Boss的决策

### 攻击模式

| 攻击 | 效果 | 适应条件 |
|-----|------|----------|
| MELEE_SWIPE | 近战范围伤害 | 近距离优先 |
| PROJECTILE | 发射3-5个弹幕 | 远距离优先 |
| CHARGE_ATTACK | 快速冲撞 | 中距离 |
| DIRECTIONAL_BURST | 向玩家偏好方向发射 | 分析出方向偏好 |
| TELEPORT_STRIKE | 传送到玩家身边攻击 | 第二阶段 |
| SHOCKWAVE | 震地波（打击跳跃玩家） | 玩家频繁跳跃 |
| ENRAGED flurry | 狂暴连击（5次快速攻击） | 狂暴模式 |

### 战斗阶段

```
100% HP ────────────────► 第一阶段
                        - 基础攻击
                        - 速度: 120

 50% HP ────────────────► 第二阶段
                        - 解锁定向爆发
                        - 解锁震地波
                        - 颜色变橙红
                        - 速度: 180

 25% HP ────────────────► 第三阶段（狂暴）
                        - 解锁传送打击
                        - 攻击冷却减少
                        - 不会晕眩
                        - 颜色变深红
                        - 速度: 280
```

## 关卡集成

| 关卡 | Boss | HP | 位置 |
|------|------|-----|------|
| 第3关 | 山地领主 | 10 | 终点前 |
| 第4关 | 洞穴守护者 | 12 | 终点前 |
| 第5关 | 暗影领主 | 20 | 最终挑战 |

## API使用

### 在关卡中创建Boss

```gdscript
# 标准Boss
create_ai_boss(x, y, boss_name, max_hp)

# 示例
create_ai_boss(3750, 520, "暗影领主", 20)
```

### Boss信号

```gdsignal
boss_defeated()  # Boss被击败时触发
phase_changed(phase: int)  # 阶段变化时触发
attack_launched(attack_type: int)  # 攻击发起时触发
```

## 调试功能

```gdscript
# 获取Boss分析数据
boss.get_behavior_summary()
# 返回: {move_preference, jump_frequency, prediction_confidence, current_phase}
```

## 扩展建议

1. **更多攻击模式** - 添加新的攻击类型
2. **Boss外观变化** - 不同阶段改变Boss大小/特效
3. **AI难度等级** - 提供简单/普通/困难模式
4. **持久化学习** - 跨关卡保存AI学习数据
5. **Boss语音** - 添加战斗语音和音效
