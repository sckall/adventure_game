# 像素地牢项目现状与改进建议（面向下一轮重构）

## 1) 当前版本现状（基于现有脚本）

### 玩法层
- 已有核心循环：`生成关卡 -> 玩家探索 -> 拾取道具 -> 清敌 -> 到出口 -> 下一关`。
- 主控逻辑集中在 `Game.gd`，包含 HUD 更新、道具拾取、敌人接触伤害、出口判定、重开逻辑。
- 关卡系统有“可持续推进”的基础（`current_level` 增长，敌人数/道具数随关卡增多）。

### 技术层
- 玩家使用 `CharacterBody2D`，运动系统完整（重力、跳跃、左右移动、无敌帧、死亡重生）。
- 地牢生成由 `Dungeon.gd` 运行时创建，采用颜色块+碰撞体，属于“原型可玩”级别。
- UI 已包含血量、进度、提示文案，但目前是静态 Label/ColorRect 组合。

### 目前的主要问题（为什么会感觉“界面很差”）
1. **视觉资产层不足**：地图/敌人/道具均为 `ColorRect` 几何块，没有统一像素美术规范。
2. **关卡语义不足**：当前更像“随机平台图”，而不是“房间-走廊”的地牢结构。
3. **战斗反馈薄弱**：攻击是按键 + 距离判定，缺少命中帧、受击反馈、击退、音效节奏。
4. **HUD 可读性一般**：信息有了，但布局层级、对比度、字体风格、状态图标不足。
5. **长期成长缺失**：关卡推进有数值增长，但没有 Build（技能/装备/词条）驱动力。

---

## 2) 建议的改进方向（按投入产出比排序）

## A. 先做“观感重建”（1~2 天可见效果）
> 目标：先把“看起来像游戏”解决掉。

- 建立统一像素规范：
  - 分辨率基准（如 320x180/640x360）、像素缩放倍数、相机缩放固定策略。
  - 固定 16x16 或 32x32 tile 资源规格。
- 把 `ColorRect` 替换为 `Sprite2D/TileMap`：
  - 地板、墙体、门、道具、敌人至少先用占位像素图。
- HUD 改成“状态条 + 图标 + 层级清晰”的像素 UI：
  - 左上角生命条 + 药水数量；
  - 右上角关卡/击杀；
  - 底部保留精简操作提示。

## B. 再做“地牢结构化”（2~4 天）
> 目标：从“随机平台”升级为“可探索地牢”。

- 地图生成改为：房间（矩形）+ 走廊（连通）+ 门。
- 以“房间”为单位生成敌人和道具，避免当前全图随机散点。
- 引入最小地图（Minimap）显示探索进度。
- 出口放在“最远房间”或“Boss 房”，形成路线目标。

## C. 战斗手感与反馈（2~3 天）
> 目标：把“能打”变成“好打”。

- 攻击系统从“按键即时判定”改成“攻击动作 + 命中盒”。
- 增加受击闪烁、击退、短暂停顿（hit stop）、受伤音效。
- 敌人区分基础 AI：巡逻/追击/远程，强化节奏差异。

## D. 养成与重玩价值（3~5 天）
> 目标：让玩家有“再来一局”的动力。

- 每层给 1 选 1/3 选 1 的增益（攻速、暴击、吸血、移速）。
- 道具分稀有度与功能（治疗、护盾、炸弹、钥匙）。
- 增加“永久解锁”（角色、初始天赋）形成中长期目标。

---

## 3) 针对当前代码的具体优化建议

1. `Game.gd` 中近战逻辑建议独立为 `CombatSystem`（或至少函数化命中检测），减少主控脚本耦合。
2. `Dungeon.gd` 建议把“生成数据”和“渲染节点”拆开：
   - 先产出 2D 数组地图数据；
   - 再由 TileMap 渲染；
   - 最后生成碰撞与实体。
3. `player.gd` 可补充：
   - 受击后材质闪烁；
   - 攻击冷却；
   - 冲刺（dash）或翻滚（i-frame）提升操作深度。
4. 增加配置文件（如 `GameConfig.gd`）：统一管理速度、伤害、刷怪数量、层数成长曲线。

---

## 4) 建议的下一步执行计划（可直接开工）

### 里程碑 M1（本周）
- 完成 TileMap 地图替换。
- 完成 HUD 像素化改造。
- 完成玩家攻击动作与命中盒。

### 里程碑 M2（下周）
- 完成房间-走廊地牢生成。
- 完成 3 类敌人行为差异。
- 完成道具系统 6~8 个基础道具。

### 里程碑 M3（后续）
- 完成小地图与事件房（商店/宝箱/精英/Boss）。
- 完成成长系统（局内 + 局外）。
- 完成首版数值平衡与可玩性调优。

---

## 5) 一句话结论
当前版本已经具备“可玩的原型骨架”，但还停留在“程序原型视觉层”；最优路径不是继续零碎微调，而是按 **视觉重建 -> 地牢结构化 -> 战斗反馈 -> 成长系统** 的顺序分阶段重构。
